name = "agent-ops"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Environment variables (set via wrangler secret)
# ENCRYPTION_KEY - for encrypting stored credentials
# GITHUB_CLIENT_ID - GitHub OAuth app client ID
# GITHUB_CLIENT_SECRET - GitHub OAuth app client secret

[vars]
ENVIRONMENT = "development"
ALLOWED_EMAILS = "me@connerswann.me"
MODAL_BACKEND_URL = "https://yourbuddyconner--{label}.modal.run"
# FRONTEND_URL - set via .dev.vars (local) or `wrangler secret put` (production)
# SANDBOX_JWT_SECRET - set via `wrangler secret put SANDBOX_JWT_SECRET`

# Durable Objects
[[durable_objects.bindings]]
name = "API_KEYS"
class_name = "APIKeysDurableObject"

[[durable_objects.bindings]]
name = "SESSIONS"
class_name = "SessionAgentDO"

[[durable_objects.bindings]]
name = "EVENT_BUS"
class_name = "EventBusDO"

[[migrations]]
tag = "v1"
new_classes = ["APIKeysDurableObject", "EventBusDO"]
new_sqlite_classes = ["SessionAgentDO"]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "agent-ops-db"
database_id = "312aaa6b-3670-4628-b612-2f6c7d30e42e" # Replace with actual ID after creation

# R2 Bucket
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "agent-ops-storage"

# Cron Triggers for scheduled syncs
[triggers]
crons = ["0 * * * *"] # Hourly sync check

# Observability (enables Worker and Container logs)
[observability]
enabled = true

# Development settings
[dev]
port = 8787
local_protocol = "http"
